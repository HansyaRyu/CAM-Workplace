<!DOCTYPE html>
<html>
<head>
    <title>Main Page</title>

    <!-- Prevent browser cache -->
    <meta http-equiv="Cache-Control" content="no-store, no-cache, must-revalidate, max-age=0">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">

    <style>
        body { 
            font-family: Arial; 
            background:#d7eaff; 
            text-align:center; 
            padding-top:50px; 
        }
        .btn {
            display:block;
            width:250px;
            margin:15px auto;
            padding:15px;
            background:#001f54;
            color:white;
            text-decoration:none;
            border-radius:8px;
            font-weight:bold;
            box-shadow:0 4px 10px rgba(0,0,0,0.2);
            transition:0.25s;
        }
        .btn:hover {
            transform: scale(1.05);
            box-shadow:0 6px 14px rgba(0,0,0,0.25);
        }
        .logout {
            background:#f7d000;
            color:black;
        }
        .logout:hover {
            background:#ffea4d;
        }
    </style>
</head>
<body>

<h2>Main Menu</h2>

<a class="btn" href="Cam 3 masterlist.html">Masterlist</a>
<a class="btn" href="Cam 4 host.html">Host</a>
<a class="btn" href="Cam 5 CAM.html">Cam</a>
<a class="btn" href="https://drive.google.com/file/d/1o2gQu3UJG6S6rTM7GISpgNQZK7zx691Q/view?usp=sharing">Work Timetable</a>

<br>

<button class="btn logout" onclick="logout()">Logout</button>

<script>
    // ===============================================================
    // REDIRECT TO LOGIN IF NOT LOGGED IN
    // ===============================================================
    function goToLogin() {
        window.location.replace("Cam 1 login.html");
    }

    function isLoggedIn() {
        return localStorage.getItem("isLogin") === "true";
    }

    // If not logged in → redirect immediately
    if(!isLoggedIn()) {
        goToLogin();
    }

    // ===============================================================
    // Undo / reopen tab handling
    // ===============================================================
    window.onpageshow = function(event) {
        // If page restored from cache
        if(event.persisted) {
            if(!isLoggedIn()) {
                // If session cleared → force login
                goToLogin();
            }
            // Otherwise, keep current workflow (do nothing)
        }
    };

    // ===============================================================
    // Back button handling
    // ===============================================================
    history.pushState(null, null, location.href);
    window.onpopstate = function () {
        if(!isLoggedIn()) {
            goToLogin();
        }
        // Logged in → normal workflow
    };

    // ===============================================================
    // AUTO LOGOUT AFTER 30 MINUTES INACTIVITY
    // ===============================================================
    const INACTIVITY_LIMIT = 30 * 60 * 1000; // 30 minutes
    let inactivityTimer;

    function resetTimer() {
        clearTimeout(inactivityTimer);
        inactivityTimer = setTimeout(autoLogout, INACTIVITY_LIMIT);
    }

    function autoLogout() {
        alert("Logged out due to 30 minutes of inactivity.");
        logout();
    }

    window.onload = resetTimer;
    document.onmousemove = resetTimer;
    document.onkeydown = resetTimer;
    document.onclick = resetTimer;
    document.onscroll = resetTimer;

    // ===============================================================
    // LOGOUT FUNCTION
    // ===============================================================
    function logout() {
        localStorage.clear();
        sessionStorage.clear();
        goToLogin();
    }
</script>

</body>
</html>
